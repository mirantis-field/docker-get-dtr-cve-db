# mirantis/get-dtr-cve-db

## Build (Optional)

**Note**: This utilizes a multi-stage build and requires Docker 17.05 or newer.  The Docker image is also available from [Docker Hub](https://hub.docker.com/r/mirantis/get-dtr-cve-db/)

```
docker build -t mirantis/get-dtr-cve-db:latest .
```

## Run

Default run command with all default environment variables specified:

```
docker run -it --rm \
  -v ${HOME}/Downloads:/data \
  -e CVE_DB_URL_ONLY=false \
  -e CLOBBER_FILE=false \
  -e DATABASE_OUTPUT="/data" \
  -e DATABASE_SCHEMA=3 \
  -e DEBUG=false \
  -e LICENSE="$(cat ~/Downloads/docker_subscription.lic)" \
  -e VERSION_ONLY=false \
  mirantis/get-dtr-cve-db:latest
```

Using the above example, if I have my Docker EE license file at `~/Downloads/docker_subscription.lic` and I want the container to output the database file to `~/Downloads`, the above command will work as expected because the volume is being mapped from my machine into the container.  If either the license or destination for the database exists in a separate directory, you would need an additional volume defined.

### Runtime environment variables overrides

**Note**: these are the values **inside** the container.  You must pass the actual parent directories as one or more volumes.

* `CLOBBER_FILE` - defaults to `false`
  * Set to `true` to overwrite an existing file of the same database name
* `CVE_DB_URL_ONLY` - defaults to `false`
  * Set to `true` to output the CVE database URL; does not download the CVE database
* `DATABASE_OUTPUT` - defaults to `/data`
  * Specifies the directory to where the database will be downloaded **inside** the container
* `DATABASE_SCHEMA` - defaults to `2`
  * `1` - DTR 2.2.5 or lower
  * `2` - DTR 2.3.x; 2.4.x; 2.5.15 or lower; 2.6.11 or lower; 2.7.4 or lower
  * `3` - DTR 2.5.16 or higher; 2.6.12 or higher; 2.7.5 or higher
* `DEBUG` - defaults to `false`
  * Set to `true` to execute the script with `set -x`
* `LICENSE` - defaults to `null`
  * `cat` your license file as an environment variable
* `LICENSE_FILE` - *(deprecated - use `LICENSE`)*; defaults to `/data/docker_subscription.lic`
  * Location of the license **inside** the container
* `VERSION_ONLY` - defaults to `false`
  * Set to `true` to output the CVE database version number; does not download the CVE database
